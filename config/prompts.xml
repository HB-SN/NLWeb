<?xml version="1.0" encoding="UTF-8"?>
<root xmlns="http://nlweb.ai/base"
      xmlns:so="http://www.schema.org/"
      xmlns:rdfs="http://www.w3.org/rdfs">

<Site id="sos-sms">
    <Item>

    <Prompt ref="DetectIrrelevantQueryPrompt">
      <promptString>
        The user is querying the site {request.site} which has information about {site.itemType}s.
        Is the site utterly completely irrelevant to the user's query? 
        The question is not whether this is the best site for answering the query, 
        but if there is nothing on the site that is likely to be relevant for the query. 
        If the site is irrelevant, add an explanation for why it is irrelevant. Otherwise, leave that field blank.
        The user query is: '{request.query}'
      </promptString>
      <returnStruc>
        {
          "site_is_irrelevant_to_query": "True or False",
          "explanation_for_irrelevance": "Explanation for why the site is irrelevant"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="PrevQueryDecontextualizer">
      <promptString>
        The user is querying the site {request.site} which has {site.itemType}s.
        Rewrite the query, incorporating the context of the previous queries and answers.
        Keep the decontextualized query short and do not reference the site. 

        If the query very clearly does not reference earlier queries, 
        don't change the query. Err on the side of incorporating the context of the 
        previous queries. If you are not sure whether this is a brand new query, 
        or follow up, it is likely a follow up. Try your best to incorporate the 
        context from the previous queries.

        The user's query is: {request.rawQuery}. 
        Previous queries were: {request.previousQueries}.
       </promptString>
      <returnStruc>
        {
          "requires_decontextualization": "True or False",
          "decontextualized_query": "The rewritten query, if decontextualization is required"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="DecontextualizeContextPrompt">
      <promptString>
        The user is asking the following question: '{request.rawQuery}' in the context of 
        the an item with the following description: {request.contextDescription}. 
        Previous answers provided were: {request.prevAnswers}.
        Rewrite the query to decontextualize it so that it can be answered 
        without reference to earlier queries, previous answers, or to the item description.
      </promptString>
      <returnStruc>
        {
          "decontextualized_query": "The rewritten query"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="FullDecontextualizePrompt">
      <promptString>
        The user is asking the following question: '{request.rawQuery}' in the context of 
        the an item with the following description: {request.contextDescription}. 
        Previous queries from the user were: {request.previousQueries}.
        Previous answers provided were: {request.prevAnswers}.
        Rewrite the query to decontextualize it so that it can be answered 
        without reference to earlier queries, previous answers, or to the item description.
      </promptString>
      <returnStruc>
        {
          "decontextualized_query": "The rewritten query"
        }
      </returnStruc>
    </Prompt>
    
    <Prompt ref="QueryRewrite">
      <promptString>
        You are helping to rewrite a complex search query into simpler keyword queries for a traditional keyword-based search engine.
        The search engine works best with short, focused queries containing important keywords.
        
        Take the following query and break it down into up to 5 simpler search queries.
        Each query should:
        - Contain no more than 3 words
        - Focus on the most important keywords and concepts
        - Be diverse to cover different aspects of the original query
        - If the query implies a need for help (e.g., medical or shelter), include keywords for both the condition/need and the provider/location.
        - Use only essential nouns, adjectives, or product terms
        - Avoid common words like "for", "the", "some", "are", "that", "would", "be"
        
        For example:
        - "what are some options for plates that would be appropriate for serving vegetables" → ["vegetable plates", "serving plates", "dinner plates", "salad plates", "ceramic plates"]
        - "looking for a tea pot that can brew green tea" → ["tea pot", "green tea", "teapot ceramic", "japanese teapot", "brewing pot"]
        
        The original query is: {request.query}
      </promptString>
      <returnStruc>
        {
          "rewritten_queries": ["query1", "query2", "query3", "query4", "query5"],
          "query_count": "Number of queries generated (1-5)"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="DetectMultiItemTypeQueryPrompt">
      <promptString>
        Analyze the following query from the user.
        Determine if the user is asking for one item or if multiple related items are logically necessary to provide a helpful answer.
        
        Crucial: If a user describes a problem, health issue, or emergency, you MUST treat this as a multi-item query. Generate independent queries for:
        1. The description/nature of the issue (e.g., MedicalCondition).
        2. The address of the service that can provide help (e.g., Hospital, Clinic, EmergencyService).

        Crucial: Always check for related SpecialAnnouncements or Events that might be relevant to the user's query, even if the user doesn't explicitly ask for them. If there are relevant SpecialAnnouncements or Events, this should also be treated as a multi-item query.
        
        The user's query is: {request.query}.
      </promptString>
      <returnStruc>
        {
          "single_item_type_query": "True or False",
          "item_queries": "Separate queries for each of the kinds of items, separated by semicolons"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="DetectItemTypePrompt">
      <promptString>
        What is the kind of item the query is likely seeking with this query: {request.query}
        
        Common item types include:
        - Emergency shelter and emergency accommodation
        - Medical care (hospitals, clinics, and emergency aid stations)
        - Medical conditions (symptoms, diseases, treatments)
        - Water and food locations
        - Contact helplines
        - Travel safety/status
        - Item (for general items)
        
        If the query involves a health problem, prioritize returning both 'MedicalCondition' and 'EmergencyService' or 'CivicStructure'.
        If the query involves a need for shelter, prioritize returning 'Accommodation'
        If the query involves a need for food or water, prioritize returning 'Event' or 'SpecialAnnouncement' for food/water distribution events
        If the query involves a need for a ContactPoint, prioritize returning the telephone number
      </promptString>
      <returnStruc>
        {
          "item_type": ""
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="DetectQueryTypePrompt">
      <promptString>
        Analyze the following query from the user. 
        Is the user asking for a list of {site.itemType} that match a certain description or are they asking for the
        details of a particular {site.itemType}?
        If the user for the details of a particular {site.itemType}, what is the name of the {site.itemType} and what
        details are they asking for? The user's query is: {request.query}.
      </promptString>
      <returnStruc>
        {
          "item_details_query": "True or False",
          "item_title": "The title of the item type, if any",
          "details_being_asked": "what details the user is asking for"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="RankingPromptWithExplanation">
      <promptString>
        Assign a score between 0 and 100 to the following {site.itemType}
        based on how relevant it is to the user's question. Use your knowledge from other sources, about the item, to make a judgement.
        Provide a short description of the item that is relevant to the user's question, without mentioning the user's question.
        Provide an explanation of the relevance of the item to the user's question, without mentioning the user's question or the score or explicitly mentioning the term relevance.
        If the score is below 75, in the description, include the reason why it is still relevant.
          
        The user's question is: {request.query}. The item's description is {item.description}
      </promptString>
      <returnStruc>
        {
          "score": "integer between 0 and 100",
          "description": "short description of the item",
          "explanation": "explanation of the relevance of the item to the user's question"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="RankingPrompt">
      <promptString>
        Assign a score between 0 and 100 to the following item
        based on how relevant it is to the user's question. Use your knowledge from other sources, about the item, to make a judgement. 
        If the score is above 50, provide a short description of the item highlighting the relevance to the user's question, without mentioning the user's question.
        Provide an explanation of the relevance of the item to the user's question, without mentioning the user's question or the score or explicitly mentioning the term relevance.
        If the score is below 75, in the description, include the reason why it is still relevant.
          

        The user's question is: \"{request.query}\". The item's description in schema.org format is \"{item.description}\".
      </promptString>
      <returnStruc>
        {
          "score": "integer between 0 and 100",
          "description": "short description of the item"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="RankingPromptForGenerate">
      <promptString>
        Assign a score between 0 and 100 to the following item
        based on useful it might be to answering the user's question. 
        The user's question is: \"{request.query}\".
        The item in schema.org format is: \"{item.description}\". Include a 
        short description of the item in the description field.
      </promptString>
      <returnStruc>
        {
          "score" : "integer between 0 and 100",
          "description" : "short description of the item"
        }
      </returnStruc>
    </Prompt>
       
    <Prompt ref="SynthesizePromptForGenerate">
      <promptString>
        Given the following items, synthesize an answer to the user's question. 
                
        For each of the items included in the answer, provide the URL of the item in 
        the 'urls' field of the structured output. Make sure to include 
        the URL for every one of the items. Do not include the URL in the answer field.
        
        Important: we are sending this over SMS, so keep the answer very concise and most useful information only. Ideally max 320 characters.
        Important: you must answer in the same language as the user's query. 
        Important: you must ensure the answer is helpful and logically complete. For example, if a health issue identified, include both information about the condition and the address/name of a nearby facility (Hospital, Clinic, or Shelter) that can help.
        Important: If a ContactPoint with a telephone number is relevant, include that in the answer.
        Important: Never include pleasentries or unnecessary information that doesn't directly help answer the user's question. For example, don't include "I hope this helps!" or "Here is what I found:" or any similar language. Just provide the answer directly.
                      
        The user's question is: {request.query}.
        The items are: {request.answers}.
      </promptString>
      <returnStruc>
        {
          "answer" : "string",
          "urls" : "urls of the items included in the answer"
        }
      </returnStruc>
    </Prompt>

     <Prompt ref="SummarizeResultsPrompt">
      <promptString>
        Given the following items, summarize the results as an answer to the user's question. `
        The user's question is: {request.query}. 
        The items are: {request.answers}.
      </promptString>
      <returnStruc>
        {
          "summary" : "string"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="DescriptionPromptForGenerate">
      <promptString>
        The item with the following description is used to answer the user's question. 
        Please provide a description of the item, in the context of the user's question
        and the overall answer.
        The user's question is: {request.query}.
        The overall answer is: {request.answer}.
        The item is: {item.description}.
      </promptString>
      <returnStruc>
        {
          "description" : "string"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="ItemMatchingPrompt">
      <promptString>
        The user is looking for some details about: {request.item_name}
        
        Assign a score between 0 and 100 for whether the following item description
        matches what the user is looking for. A score of 100 means this is exactly
        the item they want, 0 means it's completely unrelated.

        If the score is above 75, also extract the details that the user is looking for.
        Include only the details that the user is explicitly asking for.

        The details requested are: {request.details_requested}. 
        
        Item description: {item.description}
      </promptString>
      <returnStruc>
        {
          "score": "integer between 0 and 100",
          "item_details": "the specific details requested by the user"
        }
      </returnStruc>
    </Prompt>

    <Prompt ref="ExtractItemDetailsPrompt">
      <promptString>
        The user is requesting specific details about an item they previously saw.
        
        The user's query: {request.query}
        The details requested: {request.details_requested}
        
        From the following item description, extract ONLY the specific details the user is asking for.
        Be comprehensive but focused - include all relevant information for what they asked, but don't include unrelated details.
        
        For example:
        - If they ask for "ingredients", include the full ingredients list
        - If they ask for "price", include price and any pricing variations
        - If they ask for "nutrition", include all nutritional information
        - If they ask for "description", provide a clear summary of the item
        - If they ask for "instructions" or "how to make", include step-by-step instructions
        
        Item description: {item.description}
      </promptString>
      <returnStruc>
        {
          "item_name": "the name of the item",
          "requested_details": "the specific details requested by the user, formatted clearly",
          "additional_context": "any important context about these details (optional)"
        }
      </returnStruc>
    </Prompt>


    <Prompt ref="FindItemPrompt"> 
      <promptString>
        The user is looking for for an item named / described as: {item.name}
        Assign a score between 0 and 100 for whether the following item description
        matches the items the user is looking for. A score of 100 means this is exactly
        the item they want, 0 means it's completely unrelated.
        Item description: {item.description}
      </promptString>
      <returnStruc>
        {
          "score": "integer between 0 and 100"
        }
      </returnStruc>
    </Prompt>
  </Item> 
  </Site>
</root>